<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Tamil Nadu Railways Chatbot</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background: linear-gradient(#e0f7fa, #ffffff);
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
    }
    .chat-container {
      background: white;
      width: 450px;
      margin-top: 50px;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 4px 20px rgba(0,0,0,0.2);
      display: flex;
      flex-direction: column;
    }
    .chat-box {
      padding: 20px;
      height: 400px;
      overflow-y: auto;
    }
    .input-box {
      display: flex;
      padding: 10px;
      border-top: 1px solid #ccc;
      align-items: center;
    }
    input[type="text"] {
      flex: 1;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #ddd;
      margin-right: 10px;
      font-size: 14px;
    }
    button {
      background: #007bff;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 8px;
      cursor: pointer;
    }
    .feature-buttons {
      display: flex;
      justify-content: space-between;
      padding: 10px;
      background: #f1f1f1;
    }
    .feature-buttons button {
      flex: 1;
      font-size: 13px;
      padding: 8px;
      margin: 0 5px;
      background: #007bff;
      color: white;
      border-radius: 5px;
    }
    .chatbot-train {
      height: 40px;
      vertical-align: middle;
      animation: move 1.5s infinite alternate;
    }
    @keyframes move {
      0% { transform: translateX(0px); }
      100% { transform: translateX(8px); }
    }
  </style>
</head>
<body>

<div class="chat-container">
  <div class="chat-box" id="chatBox">
    <div><strong>ðŸš† Chatbot:</strong> Welcome to Tamil Nadu Railways! How can I help you today?</div>
  </div>

  <div class="feature-buttons">
    <button onclick="sendQuick('Book Ticket')">Book Ticket</button>
    <button onclick="sendQuick('Platform Info')">Platform Info</button>
    <button onclick="sendQuick('Help')">Railway Help</button>
    <button onclick="alert('ðŸ“ž Tamil Nadu Railways Customer Care: 139')">Customer Care</button>
  </div>

  <div class="input-box">
    <img src="/d6ab19ee-907b-46e0-bb85-2192f5014690.png" alt="chatbot-train" class="chatbot-train">
    <input type="text" id="userInput" placeholder="Type your message here..." onkeydown="if(event.key==='Enter')sendMessage()">
    <button onclick="sendMessage()">Send</button>
  </div>
</div>

<script>
  const chatBox = document.getElementById('chatBox');
  const userInput = document.getElementById('userInput');

  function appendMessage(sender, message) {
    const msgDiv = document.createElement('div');
    msgDiv.style.margin = '10px 0';
    msgDiv.innerHTML = `<strong>${sender}:</strong> ${message}`;
    chatBox.appendChild(msgDiv);
    chatBox.scrollTop = chatBox.scrollHeight;
  }

  function sendQuick(message) {
    userInput.value = message;
    sendMessage();
  }

  async function sendMessage() {
    const message = userInput.value.trim();
    if (!message) return;
    appendMessage("You", message);
    userInput.value = '';
    userInput.focus();

    const loading = document.createElement('div');
    loading.innerHTML = `<span style="color:#007bff;">Typing...</span>`;
    chatBox.appendChild(loading);
    chatBox.scrollTop = chatBox.scrollHeight;

    const response = await fetch('/ask', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ message })
    });
    const data = await response.json();

    chatBox.removeChild(loading);
    appendMessage("ðŸš† Chatbot", data.reply);

    if (data.redirect) {
      setTimeout(() => {
        window.location.href = data.redirect;
      }, 1500);
    }
  }

  window.onload = () => {
    userInput.focus();
  };
</script>

</body>
</html>
